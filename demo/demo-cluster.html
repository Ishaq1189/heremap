<html>

<head>
    <title>HERE Cluster demo</title>
    <meta name="viewport" content="initial-scale=1.0, width=device-width" />
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">

    <link rel="stylesheet" type="text/css" href="http://www.unpkg.com/heremap@2.0.1/css/heremap.css" />

</head>

<body>
    <div id="map"></div>

    <!--  our business logic -->
    <script src="http://www.unpkg.com/heremap@2.0.2/dist/libhere.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../dist/heremap.min.js" type="text/javascript" charset="utf-8"></script>

    <!--  convenient way to define APP_ID and APP_CODE and bnot expose it to the whole world... -->
    <script src="credentials.js" type="text/javascript" charset="utf-8"></script>

    <!--  mcdo data for cluster -->
    <script src="mcdonalds.js" type="text/javascript" charset="utf-8"></script>


    <script>

        var hm = window.heremap;

        function initMap() {

            //configure APP_ID and APP_CODE
            hm.config({
                app_id: APP_ID,
                app_code: APP_CODE,
            });

            // show map fragment
            // to see console message, open debugger window
            hm.map(
                "map", {
                    zoom: 6,
                    viewChange: (zoom, coord) => { console.log("viewchange", zoom, coord) },
                    click: (coord, button, key) => { console.log("click", coord, button, key) },
                    keydown: (key) => { console.log("key down", key) }
                }
            );

        };

        async function demo() {

            // convert source file into array of [lat,lng,payload]
            let mcdos = macdonalds.map(mcdo => [mcdo.y, mcdo.x, mcdo]);

            hm.cluster(mcdos, {
                noise: ["mcdo.png", 24],
                clusterIcon: '../svg/cluster2.svg',    //  icon for cluster
                style: {
                    75: { color: "#FF6900", size: 58 },
                    2: { color: "#7BD30A", size: 46 },
                    200: { color: "#B50015", size: 64 }
                }
            },
                (event, coord, data, weight) => {
                    console.log("coord", coord);
                    if (data)
                        hm.bubbleUnique(coord, data.type + ", " + data.location);
                    else
                        hm.bubbleUnique(coord, "weight: " + weight);
                });
        }

        initMap();
        demo();

    </script>
</body>


</html>