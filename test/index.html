<html>

<head>
    <title>HERE Generic map</title>

    <meta name="viewport" content="initial-scale=1.0, width=device-width" />
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">

    <link rel="stylesheet" type="text/css" href="http://www.unpkg.com/heremap@2.0.0/css/heremap.css" />

</head>

<body>
    <div id="mymap"></div>



    <!--  our business logic -->
    <script src="http://www.unpkg.com/heremap@2.0.0//dist/libhere.min.js" type="text/javascript" charset="utf-8"></script>
    <!--script src="http://www.unpkg.com/heremap@2.0.0/dist/heremap.min.js" type="text/javascript" charset="utf-8"></script-->
    <script src="../dist/heremap.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="credentials.js" type="text/javascript" charset="utf-8"></script>

    <!--  mcdo data for cluster -->
    <script src="mcdonalds.js" type="text/javascript" charset="utf-8"></script>

    <script>

        var hm = window.heremap;

        hm.config({
            app_id: APP_ID,
            app_code: APP_CODE,
        });

        hm.map(
            "mymap", {

                viewChange: (zoom, coord) => { console.log("viewchange", zoom, coord) },
                click: (coord, button, key) => { console.log("click", coord, button, key) },
                keydown: (key) => { console.log("down", key) }
            }
        );

        hm.locateMe(function (coord, acc) {
            console.log("gps", coord, acc)
        }, {
                xposition: {
                    svg: "svg/locate.svg",
                    color: "green",
                    color2: "grey",
                    size: 16,
                    anchor: 8
                }
            }
        );

        hm.marker({
            coord: [48.85, 2.3],
            svg: "svg/cluster.svg",
            opt: {
                size: 48,
                anchor: "24x24",
                color: "#0000FF",
                text: "Hey"
            }
        });

        hm.marker({
            coord: [48.86, 2.3],
            img: "http://maps.google.com/mapfiles/kml/paddle/B.png",
            opt: { size: 32 }
        });
        hm.marker({
            coord: [48.8, 2.3],
            draggable: true,
            data: "Hello <b>world</b>",
            dragged: (target, coord) => {
                console.log("dragged to", coord);
                hm.setCenter(coord);
            },
            bubble: true
        });


        // convert source file into array of [lat,lng,payload]
        let mcdos = macdonalds.map(mcdo => [mcdo.y, mcdo.x, mcdo]);

        hm.cluster(mcdos, {
            noise: ["mcdo.png", 24],
            clusterIcon: '../svg/cluster2.svg',    //  icon for cluster
            style: {
                75: { color: "#FF6900", size: 58 },
                2: { color: "#7BD30A", size: 46 },
                200: { color: "#B50015", size: 64 }
            }
        },
            (event, coordinate, data, weight) => {
                if (data)
                    console.log("click on point ", data);
                else
                    console.log("click on cluster with weight", weight);
            });


        async function test() {
            let res = await hm.geocode("Avenue des champs elysees, Paris");
            console.log("geocode of Champs elysees", res.coord);

            try {
                res = await hm.geocode("gklgklflkg")
                console.log("wrong address", res.coord);
            }
            catch (e) {
                console.log(e);
            }

            try {
                res = await hm.reverseGeocode([48.8714, 2.30247]);
                console.log("reversegeocode", res.address);
            }
            catch (e) {
                console.log(e);
            }
        }

        test();

    </script>
</body>


</html>